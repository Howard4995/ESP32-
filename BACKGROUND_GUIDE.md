# 背景圖片自訂功能使用說明

## 新功能概述

ESP32 信息牌現在支援自訂背景圖片功能，並在自訂背景上使用毛玻璃效果顯示資訊區塊，保持清晰可讀的同時增加視覺美感。

## 設定步驟

### 1. 進入設定模式
- 首次啟動或重設後，ESP32 會自動進入 AP 模式
- 連接 WiFi 網路：`ESP32-InfoBoard-Setup`（密碼：`12345678`）
- 開啟瀏覽器訪問：`http://192.168.4.1`

### 2. 基本設定
在網頁介面中填入：
- WiFi SSID 和密碼
- 和風天氣 API Key
- 城市名稱

### 3. 背景樣式選擇
在「背景樣式」區段：
- **原始樣式**：保持原有的深藍灰純色背景
- **自訂圖片背景**：使用上傳的圖片作為背景，並啟用毛玻璃效果

### 4. 上傳背景圖片
選擇「自訂圖片背景」後：
1. 準備圖片（建議 320×240 像素）
2. 支援格式：JPG、PNG
3. 檔案大小建議小於 1MB
4. 點擊「選擇圖片檔案」上傳
5. 可預覽圖片效果
6. 點擊「上傳背景圖片」完成

## 視覺效果

### 原始樣式
- 深藍灰色背景（#0861）
- 深灰色資訊區塊（#2124）
- 傳統 iOS Widgets 風格

### 自訂背景 + 毛玻璃效果
- 自訂圖片作為背景
- 半透明白色資訊區塊（rgba(255,255,255,0.15)）
- 模糊背景效果模擬
- 細微邊框增強玻璃質感
- 文字自動調整對比度

## 技術實現

### 檔案系統
- 使用 LittleFS 儲存背景圖片
- 圖片轉換為 16-bit RGB565 格式
- 檔案路徑：`/background.raw`

### 顯示渲染
- 逐像素讀取並顯示背景圖片
- 動態切換資訊區塊顏色
- 保持原有繪圖函數相容性

### API 端點
- `POST /api/save`：保存設定（包含背景樣式）
- `POST /api/upload`：上傳背景圖片
- `GET /api/test-image`：產生測試漸層背景

## 使用建議

### 背景圖片選擇
- 使用對比度適中的圖片
- 避免過於複雜或高對比的圖案
- 風景、漸層、抽象圖案效果較佳
- 考慮長時間觀看的舒適度

### 效能考量
- 圖片檔案越小載入越快
- 簡單圖案比複雜圖案效能更好
- 重啟後會重新載入背景圖片

## 故障排除

### 圖片無法顯示
1. 檢查檔案格式是否支援
2. 確認檔案大小合適
3. 重新上傳圖片
4. 重啟裝置

### 文字不清楚
1. 更換對比度更好的背景圖片
2. 選擇較淺色或較深色的純色背景
3. 暫時切換回原始樣式

### 系統問題
1. 重設 ESP32 回到 AP 模式
2. 重新設定 WiFi 和背景
3. 檢查 LittleFS 檔案系統狀態

## 開發者注意事項

### 新增的全域變數
```cpp
String background_style = "original";  // "original" 或 "custom"
bool hasCustomBackground = false;
```

### 新增的顏色定義
```cpp
#define COLOR_GLASS   0x39E7    // 半透明白色 (毛玻璃效果)
```

### 新增的函數
- `checkCustomBackground()`：檢查自訂背景檔案
- `drawBackground()`：繪製背景
- `drawCustomBackground()`：繪製自訂背景圖片
- `drawGlassWidget()`：繪製毛玻璃效果區塊